---
published: true
layout: post
title: PlaySms 1.4代码执行漏洞分析
category: Web漏洞
tags: 
  - Vulnerability
time: 2017.05.15 20:19:00
excerpt: PlaySms是一个灵活的基于Web的短信平台，可连接短信网关、个人信息系统以及企业的群组通讯工具等。本次爆出的漏洞是1.4版本的一个代码执行漏洞，该漏洞在exploit-db上有所收录，详情可参考https://www.exploit-db.com/exploits/42003/。

---

PlaySms是一个灵活的基于Web的短信平台，可连接短信网关、个人信息系统以及企业的群组通讯工具等。本次爆出的漏洞是1.4版本的一个代码执行漏洞，该漏洞在exploit-db上有所收录，详情可参考https://www.exploit-db.com/exploits/42003/。

<!--more-->

# PlaySms 1.4代码执行漏洞分析
## 官方文案描述
- Exploit标题：PlaySMS 1.4 sendfromfile.php中使用`$filename`变量以及不严格的文件上传导致代码执行
- Date: 14-05-2017
- 软件链接：Software Link: https://playsms.org/download/
- 版本: 1.4
- Exploit作者：Touhid M.Shaikh
- 联系: http://twitter.com/touhidshaikh22
- 网站: http://touhidshaikh.com/
- 类别：webapps

1. 描述
- 不严格文件上传：
	- 任何注册的用户都可以上传任何类型的文件，因为在sendfromfile.php中没有任何的文件合法性检查。

- 使用`$filename`代码执行：
	- 我们知道了sendfromfile.php接受任何扩展名的文件，且仅仅只是读取内容而不会存储在server中。但当用户这样上传时依然有bug：服务器会欣然接受mybackdoor.php且不会存在任何一个目录中，因此我们的shell也就没什么卵用。但是如果用户将文件名从"mybackdoor.php"更改为"<?php system('uname -a'); dia();?>.php"，则服务器会检查该文件并将如是设置参数，`$filename="<?php system('uname -a'); dia();?>.php"`。你可以在页面上看到下面的代码并显示$filename。
	- 更多信息： www.touhidshaikh.com/blog/
2. POC
作为一般用户登录（在index.php?app=main&inc=core_auth&route=register创建用户）：

去：http://127.0.0.1/playsms/index.php?app=main&inc=feature_sendfromfile&op=list

form如下：
```html
----------------------------Form for upload CSV file ----------------------
<form action=\"index.php?app=main&inc=feature_sendfromfile&op=upload_confirm\" enctype=\"multipart/form-data\" method=\"post\">
" . _CSRF_FORM_ . "
<p>" . _('Please select CSV file') . "</p>
<p><input type=\"file\" name=\"fncsv\"></p>
<p class=help-block>" . _('CSV file format') . " : " . $info_format . "</p>
<p><input type=checkbox name=fncsv_dup value=1 checked> " . _('Prevent duplicates') . "</p>
<p><input type=\"submit\" value=\"" . _('Upload file') . "\" class=\"button\"></p>
</form>
------------------------------Form ends ---------------------------

-------------PHP code for set parameter ---------------------------

	case 'upload_confirm':
		$filename = $_FILES['fncsv']['name'];

------------------------------php code ends ---------------------------
```

$filename应该在页面上可见：
```
----------------------Vulnerable perameter show ----------------------

line 123 : $content .= _('Uploaded file') . ': ' . $filename . '<p />';

----------------------------------------------------------------------
```

## 搭建环境测试
exploit-db给的信息已是相当充足，提供了Exploit的下载，以及包含该漏洞的App。由于这一漏洞十分的简单，所以我们搭建环境复现一下，再进行进一步的分析与说明。

待续。。。